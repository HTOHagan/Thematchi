<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Golfshi — Match Odds</title>
  <style>
    :root{
      --bg:#0b1020; --text:#e9eeff; --muted:#a8b3d6; --line:rgba(255,255,255,.10);
      --shadow:0 12px 30px rgba(0,0,0,.35); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(56,217,150,.14), transparent 55%),
        radial-gradient(900px 650px at 85% 20%, rgba(80,140,255,.14), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    header{max-width:900px;margin:0 auto;padding:22px 16px 10px}
    h1{margin:0;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin-top:4px}
    main{max-width:900px;margin:0 auto;padding:0 16px 28px}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      margin-top:14px;
    }
    .hd{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background:rgba(255,255,255,.02);
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap
    }
    .pill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;
      padding:7px 10px;
      background:rgba(27,39,80,.55)
    }
    .pill strong{color:var(--text)}
    .bd{padding:16px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input,button{font:inherit}
    input{
      width:100%;padding:12px;border-radius:12px;
      border:1px solid var(--line);
      background:rgba(10,16,40,.55);
      color:var(--text)
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1;min-width:200px}
    button{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(42,60,122,.95), rgba(34,52,107,.95));
      color:var(--text);
      padding:12px;border-radius:12px;
      cursor:pointer;font-weight:900;
    }
    button.secondary{background:rgba(18,26,51,.55)}
    button:disabled{opacity:.5}

    .seg{display:flex;gap:12px;flex-wrap:wrap}
    .segBtn{
      flex:1;padding:18px;border-radius:16px;
      font-weight:950;font-size:16px
    }

    .market{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
    @media(max-width:540px){.market{grid-template-columns:1fr}}

    .side{
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(15,23,48,.6);
      padding:14px
    }
    .name{font-weight:950;margin-bottom:6px}
    .price{display:flex;justify-content:space-between}
    .big{font-size:34px;font-weight:980}
    .small{font-size:12px;color:var(--muted)}
    .preset{display:flex;gap:8px;margin-top:8px}
    .preset button{padding:10px 12px}
    .hidden{display:none!important}
  </style>
</head>

<body>
<header>
  <h1>Golfshi — The Match Odds</h1>
  <div class="sub">Unc & Ferrier vs Dorrin & Dom</div>
</header>

<main>
<!-- AUTH -->
<section class="card" id="authCard">
  <div class="hd">
    <div class="pill"><strong>Step 1:</strong> Sign in</div>
    <div class="pill" id="authPill"><strong>Status:</strong> not logged in</div>
  </div>
  <div class="bd">
    <label>Choose:</label>
    <div class="seg">
      <button id="modeNewBtn" class="segBtn" onclick="setAuthMode('new')">New user</button>
      <button id="modeReturningBtn" class="segBtn secondary" onclick="setAuthMode('returning')">Returning user</button>
    </div>

    <div id="newUserPanel" style="margin-top:14px">
      <label>Name</label>
      <input id="newName" placeholder="Enter your name" />
      <label style="margin-top:10px">PIN (4+ chars)</label>
      <input id="newPin" type="password" placeholder="Enter PIN" />
      <button style="margin-top:12px" onclick="registerNewUser()">Create account</button>
    </div>

    <div id="returningUserPanel" class="hidden" style="margin-top:14px">
      <label>Name</label>
      <input id="returnName" />
      <label style="margin-top:10px">PIN</label>
      <input id="returnPin" type="password" />
      <button style="margin-top:12px" onclick="loginReturningUser()">Login</button>
    </div>
  </div>
</section>

<!-- BETTING -->
<section class="card hidden" id="betCard">
  <div class="hd">
    <div class="pill" id="statusPill"></div>
    <div class="pill" id="userPill"></div>
    <div class="pill" id="linePill"></div>
  </div>

  <div class="bd">
    <div class="row">
      <div class="pill">
        <strong>You can bet up to:</strong>
        <span id="remaining">—</span> more points (max <span id="maxPts">—</span>)
      </div>
      <button class="secondary" onclick="logout()">Log out</button>
    </div>

    <label style="margin-top:12px">Bet points</label>
    <input id="points" type="number" min="1" value="10" />
    <div class="preset">
      <button class="secondary" onclick="setPts(5)">5</button>
      <button class="secondary" onclick="setPts(10)">10</button>
      <button class="secondary" onclick="setPts(20)">20</button>
      <button class="secondary" onclick="setPts(50)">50</button>
      <button class="secondary" onclick="setPts(100)">100</button>
    </div>

    <div class="market">
      <div class="side">
        <div class="name" id="teamA"></div>
        <div class="price"><div class="big" id="pA"></div><div class="small">implied</div></div>
        <div class="small" id="ptsA"></div>
        <button id="betA" onclick="bet('A')">Bet on A</button>
      </div>
      <div class="side">
        <div class="name" id="teamB"></div>
        <div class="price"><div class="big" id="pB"></div><div class="small">implied</div></div>
        <div class="small" id="ptsB"></div>
        <button id="betB" class="secondary" onclick="bet('B')">Bet on B</button>
      </div>
    </div>
  </div>
</section>
</main>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbzpqVGmZXp5FKwwleLFZ6uXwJJmddcPz9DKkKBD-yRl-Xpx1ySfwblQiqpxETzIk6OYCw/exec";
const $=id=>document.getElementById(id);
let session={name:"",pin:""};

function setPts(n){$("points").value=n}
function showBetting(){authCard.classList.add("hidden");betCard.classList.remove("hidden")}
function showAuth(){betCard.classList.add("hidden");authCard.classList.remove("hidden")}
function saveSession(){localStorage.setItem("golfshi_name",session.name);localStorage.setItem("golfshi_pin",session.pin)}
function loadSession(){session={name:localStorage.getItem("golfshi_name")||"",pin:localStorage.getItem("golfshi_pin")||""}}
function clearSession(){localStorage.clear();session={name:"",pin:""}}

function setAuthMode(m){
  newUserPanel.classList.toggle("hidden",m!=="new");
  returningUserPanel.classList.toggle("hidden",m!=="returning");
  modeNewBtn.classList.toggle("secondary",m!=="new");
  modeReturningBtn.classList.toggle("secondary",m!=="returning");
}

async function apiPost(p){
  const f=new URLSearchParams(p);
  const r=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:f});
  return r.json()
}

async function registerNewUser(){
  const name=newName.value.trim(),pin=newPin.value.trim();
  if(!name||pin.length<4)return alert("Enter name and 4+ char PIN");
  const r=await apiPost({action:"register",name,pin});
  if(!r.ok)return alert(r.error);
  session={name,pin};saveSession();showBetting();render(r.state);renderBalance(r.balance)
}

async function loginReturningUser(){
  const name=returnName.value.trim(),pin=returnPin.value.trim();
  if(!name||!pin)return alert("Enter name and PIN");
  const r=await apiPost({action:"login",name,pin});
  if(!r.ok)return alert(r.error);
  session={name,pin};saveSession();showBetting();render(r.state);renderBalance(r.balance)
}

function logout(){clearSession();setAuthMode("returning");showAuth()}

async function bet(side){
  const pts=+points.value;
  if(pts<=0)return;
  const r=await apiPost({action:"bet",name:session.name,pin:session.pin,side,points:pts});
  if(!r.ok)return alert(r.error);
  render(r.state);renderBalance(r.balance)
}

function renderBalance(b){remaining.textContent=b.remaining;maxPts.textContent=b.maxPts}

function render(st){
  teamA.textContent=st.teams.A;teamB.textContent=st.teams.B;
  pA.textContent=Math.round(st.odds.pA*100)+"%";
  pB.textContent=Math.round(st.odds.pB*100)+"%";
  ptsA.textContent=st.totals.ptsA+" pts on A";
  ptsB.textContent=st.totals.ptsB+" pts on B";
  statusPill.textContent="Status: "+(st.locked?"LOCKED":"OPEN");
  userPill.textContent="You: "+session.name;
  linePill.textContent=`Line: ${Math.round(st.odds.pA*100)}/${Math.round(st.odds.pB*100)}`;
  betA.disabled=st.locked;betB.disabled=st.locked
}

(async function(){
  setAuthMode("new");showAuth();loadSession();
  if(session.name&&session.pin){
    const r=await apiPost({action:"login",name:session.name,pin:session.pin});
    if(r.ok){showBetting();render(r.state);renderBalance(r.balance)}
  }
})();
</script>
</body>
</html>
