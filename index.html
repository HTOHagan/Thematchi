<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Golfshi — Match Odds</title>

<style>
:root{
  --bg:#0b1020; --text:#e9eeff; --muted:#a8b3d6; --line:rgba(255,255,255,.10);
  --shadow:0 12px 30px rgba(0,0,0,.35); --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(56,217,150,.14), transparent 55%),
    radial-gradient(900px 650px at 85% 20%, rgba(80,140,255,.14), transparent 55%),
    var(--bg);
  color:var(--text);
  min-height:100vh;
}
main{max-width:760px;margin:0 auto;padding:0 16px 28px}
header{text-align:center;padding:22px 16px}
h1{margin:0;font-size:26px;font-weight:900}
.sub{color:var(--muted);margin-top:6px}

.card{
  background:rgba(255,255,255,.04);
  border:1px solid var(--line);
  border-radius:18px;
  box-shadow:var(--shadow);
  margin-top:14px;
}
.hd{
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  display:flex;gap:10px;flex-wrap:wrap;
}
.bd{padding:16px}
.pill{
  font-size:13px;font-weight:900;color:var(--muted);
  border:1px solid var(--line);
  border-radius:12px;
  padding:7px 10px;
  background:rgba(27,39,80,.55)
}
.pill strong{color:var(--text)}
.hidden{display:none!important}
button{
  border:1px solid var(--line);
  background:#2a3c7a;
  color:var(--text);
  padding:14px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
}
button.secondary{background:#182033}
button.active{background:#4f8cff}
input{
  width:100%;padding:12px;border-radius:12px;
  border:1px solid var(--line);
  background:#0a1028;color:var(--text)
}
.market{display:grid;gap:12px;margin-top:14px}
.side{
  border:1px solid var(--line);
  border-radius:16px;
  padding:14px;
  background:#0f1730
}
.avatar{width:75px;height:75px;border-radius:20px;overflow:hidden}
.avatar img{width:100%;height:100%;object-fit:cover}
.big{font-size:46px;font-weight:900}
.betBtn{width:100%;margin-top:12px}
.modalBackdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;
}
.modalBackdrop.show{display:flex}
.modal{
  background:#0f1730;padding:20px;border-radius:18px;
  width:min(520px,100%)
}
</style>
</head>

<body>
<header>
  <h1>Golfshi — The Match Odds</h1>
  <div class="sub" id="subtitle">Loading…</div>
</header>

<main>

<section class="card" id="authCard">
  <div class="hd">
    <div class="pill"><strong>Login</strong></div>
  </div>
  <div class="bd">
    <input id="name" placeholder="Name" />
    <input id="pin" type="password" placeholder="PIN" style="margin-top:10px" />
    <button style="margin-top:12px" onclick="login()">Enter</button>
  </div>
</section>

<section class="card hidden" id="betCard">
  <div class="hd">
    <div class="pill" id="statusPill"></div>
    <div class="pill" id="userPill"></div>
  </div>

  <div class="bd">
    <div class="pill" id="linePill"></div>

    <div class="market">
      <div class="side">
        <div style="display:flex;gap:10px;align-items:center">
          <div class="avatar"><img id="imgA"></div>
          <div id="teamA"></div>
        </div>
        <div class="big" id="pA"></div>
        <div id="ptsA"></div>
        <button class="betBtn" onclick="bet('A')">Bet Team A</button>
      </div>

      <div class="side">
        <div style="display:flex;gap:10px;align-items:center">
          <div class="avatar"><img id="imgB"></div>
          <div id="teamB"></div>
        </div>
        <div class="big" id="pB"></div>
        <div id="ptsB"></div>
        <button class="betBtn secondary" onclick="bet('B')">Bet Team B</button>

        <div style="margin-top:10px">
          <input id="adminPin" type="password" placeholder="Admin PIN" />
          <button onclick="setWinner('A')">Winner A</button>
          <button onclick="setWinner('B')">Winner B</button>
        </div>
      </div>
    </div>
  </div>
</section>

</main>

<div class="modalBackdrop" id="modal">
  <div class="modal">
    <div id="modalText"></div>
    <button onclick="closeModal()">Close</button>
  </div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbzxOVSjxpBDALIibr1bnqDJW7eYYIwlXGW2srhTyJ2KYedOuJkNO_jgDzPOWuDXxf4H3A/exec";
let session={name:"",pin:""};

const $=id=>document.getElementById(id);

async function api(p){
  const f=new URLSearchParams(p);
  const r=await fetch(SCRIPT_URL,{method:"POST",body:f});
  return r.json();
}

async function login(){
  session.name=$("name").value.trim();
  session.pin=$("pin").value.trim();
  const r=await api({action:"login",...session});
  if(!r.ok){alert(r.error);return;}
  $("authCard").classList.add("hidden");
  $("betCard").classList.remove("hidden");
  render(r.state);
}

async function bet(side){
  const r=await api({action:"bet",...session,side,points:10});
  if(!r.ok){alert(r.error);return;}
  render(r.state);
}

async function setWinner(w){
  const pin=$("adminPin").value.trim();
  const r=await api({action:"setwinner",winner:w,adminPin:pin});
  if(!r.ok){alert(r.error);return;}
  alert("Winner set");
}

function render(s){
  $("subtitle").textContent=`${s.teams.A} vs ${s.teams.B}`;
  $("teamA").textContent=s.teams.A;
  $("teamB").textContent=s.teams.B;
  $("imgA").src=s.teams.A_IMG;
  $("imgB").src=s.teams.B_IMG;
  $("pA").textContent=Math.round(s.odds.pA*100)+"%";
  $("pB").textContent=Math.round(s.odds.pB*100)+"%";
  $("ptsA").textContent=s.totals.ptsA+" pts";
  $("ptsB").textContent=s.totals.ptsB+" pts";
  $("statusPill").innerHTML="<strong>Status:</strong> "+(s.locked?"LOCKED":"OPEN");
  $("userPill").innerHTML="<strong>You:</strong> "+session.name;
}
</script>

</body>
</html>
